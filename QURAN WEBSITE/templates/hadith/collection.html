{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="page-header">
        <h1 class="arabic-heading" style="font-size:2.5rem;">{{ collection.name }}</h1>
        <p>{{ collection.name_en }} â€” {{ collection.author }}</p>
    </div>

    <div class="container-narrow">
        {% for hadith in hadiths %}
        <div class="hadith-card">
            <div class="hadith-header">
                <span class="hadith-number">Ø­Ø¯ÙŠØ« Ø±Ù‚Ù… {{ hadith.hadithnumber }}</span>
                <div style="display:flex;gap:0.375rem;">
                    <button class="verse-btn" onclick="copyHadith(this)" title="Ù†Ø³Ø®"
                        data-text="{{ hadith.text }}">ğŸ“‹</button>
                    <button class="verse-btn" onclick="shareHadith('{{ collection.name }}', {{ hadith.hadithnumber }})"
                        title="Ù…Ø´Ø§Ø±ÙƒØ©">ğŸ“¤</button>
                </div>
            </div>
            <p class="hadith-text">{{ hadith.text }}</p>
        </div>
        {% endfor %}

        {% if not hadiths %}
        <div class="text-center py-4">
            <div class="loader">
                <div class="spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«...</p>
            </div>
        </div>
        {% endif %}

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
            <a href="/hadith/{{ collection_id }}?page={{ page - 1 }}&section={{ section }}" class="page-btn">â†
                Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
            {% if p <= 5 or p> total_pages - 3 or (p >= page - 1 and p <= page + 1) %} <a
                    href="/hadith/{{ collection_id }}?page={{ p }}&section={{ section }}"
                    class="page-btn {% if p == page %}active{% endif %}">{{ p }}</a>
                    {% elif p == 6 or p == total_pages - 3 %}
                    <span class="text-tertiary">â€¦</span>
                    {% endif %}
                    {% endfor %}

                    {% if page < total_pages %} <a
                        href="/hadith/{{ collection_id }}?page={{ page + 1 }}&section={{ section }}" class="page-btn">
                        Ø§Ù„ØªØ§Ù„ÙŠØ© â†’</a>
                        {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<script>
    function copyHadith(btn) {
        const text = btn.getAttribute('data-text');
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = 'âœ“';
            setTimeout(() => btn.textContent = 'ğŸ“‹', 1500);
        });
    }
    function shareHadith(collection, number) {
        const card = event.target.closest('.hadith-card');
        const text = card.querySelector('.hadith-text').textContent.trim();
        const shareText = `${text}\n\nâ€” ${collection}ØŒ Ø­Ø¯ÙŠØ« Ø±Ù‚Ù… ${number}`;
        if (navigator.share) {
            navigator.share({ text: shareText });
        } else {
            navigator.clipboard.writeText(shareText).then(() => alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
        }
    }
</script>
{% endblock %}